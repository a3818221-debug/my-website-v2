// live-cricket.js ‚Äî Single file: Backend + Frontend + Multi‚Äëtabs + Light/Dark + Hindi/English + SSE Push + Configurable intervals + PWA + SEO/OG + Ad slots + GA4 // Run:  npm init -y && npm install express node-fetch && node live-cricket.js // Open:  http://localhost:3000

const express = require("express"); const fetch = require("node-fetch");

const app = express(); const PORT = process.env.PORT || 3000;

// ---- SOURCES (Unofficial; may change/break) ---- const MATCHES_URL = "https://www.cricbuzz.com/match-api/livematches.json"; // list of live matches const MATCH_URL = (id) => https://www.cricbuzz.com/match-api/${id}.json;   // single match

// Small util to fetch JSON with UA + timeout async function fetchJSON(url, { timeoutMs = 10000 } = {}){ const ctrl = new AbortController(); const t = setTimeout(()=>ctrl.abort(), timeoutMs); try{ const r = await fetch(url, { headers: { 'User-Agent': 'Mozilla/5.0' }, signal: ctrl.signal }); if(!r.ok) throw new Error('HTTP '+r.status); return await r.json(); } finally { clearTimeout(t); } }

// ---------- FRONTEND (served inline) ---------- app.get('/', (_req, res) => { res.setHeader('Cache-Control','no-cache'); res.send(`

<!DOCTYPE html><html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üèè Live Cricket ‚Äî Fast, Clean Scorecards</title>
  <meta name="description" content="Live cricket scores with a clean, fast UI. Multi‚Äëmatch tabs, Hindi/English, light/dark themes, and push updates." />
  <meta property="og:title" content="Live Cricket ‚Äî Fast, Clean Scorecards" />
  <meta property="og:description" content="Multi‚Äëmatch tabs, Hindi/English, light/dark themes, push updates (SSE), PWA support." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/icon.svg" />
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <meta name="theme-color" content="#0b1220" />
  <style>
    :root{
      --bg:#0b1220; --card:#111a2c; --muted:#94a3b8; --text:#e8eefc; --accent:#3ea6ff; --ring:rgba(62,166,255,.35);
      --ok:#21c55d; --warn:#facc15; --border:rgba(255,255,255,.09);
    }
    html[data-theme="light"]{
      --bg:#f4f7ff; --card:#ffffff; --muted:#56627a; --text:#0b1220; --accent:#1a72ff; --ring:rgba(26,114,255,.35);
      --ok:#15803d; --warn:#ca8a04; --border:rgba(10,20,40,.12);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:linear-gradient(135deg,var(--bg),#0e1630);color:var(--text)}
    header{position:sticky;top:0;z-index:10;background:color-mix(in oklab,var(--bg) 85%, transparent);backdrop-filter:blur(10px);padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px}
    header h1{font-size:18px;letter-spacing:.3px;margin:0;display:flex;align-items:center;gap:8px}
    .right{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
    .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--ring);color:var(--accent);background:color-mix(in oklab,var(--accent) 15%, transparent)}.container{max-width:1100px;margin:0 auto;padding:16px}

/* Match list */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,.12)}
.match{cursor:pointer;display:flex;gap:10px;align-items:center}
.match:hover{outline:2px solid var(--ring)}
.meta{font-size:12px;color:var(--muted)}

/* Logo badge */
.logo{width:42px;height:42px;border-radius:50%;display:grid;place-items:center;font-weight:800}
.logo span{filter:drop-shadow(0 1px 0 rgba(0,0,0,.35))}

/* Tabs */
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.tab{display:flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:color-mix(in oklab,var(--accent) 8%, var(--card));cursor:pointer}
.tab.active{outline:2px solid var(--ring)}
.tab .x{opacity:.7;cursor:pointer}

/* Scorecard */
#scorewrap{display:none}
.toprow{display:flex;align-items:center;justify-content:space-between;gap:12px}
.teams{display:flex;align-items:center;gap:10px}
.names{display:flex;align-items:center;gap:8px}
.vs{opacity:.6;font-size:12px;margin:0 2px}
.big{font-size:28px;font-weight:800}
.sub{font-size:12px;color:var(--muted)}
.status{margin-top:8px;color:var(--muted)}

.tables{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
@media(min-width:900px){.tables{grid-template-columns:1fr 1fr}}

table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:8px;border-bottom:1px dashed var(--border);text-align:left}
th{color:var(--muted)}

.toolbar{display:flex;align-items:center;gap:8px;margin:12px 0;flex-wrap:wrap}
button{background:transparent;color:var(--text);border:1px solid color-mix(in oklab,var(--text) 20%, transparent);padding:8px 10px;border-radius:10px;cursor:pointer}
button:hover{border-color:var(--accent)}
input[type="number"]{width:92px;padding:6px 8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)}

.blink{animation:blink 1s steps(2,end) infinite}
@keyframes blink{to{visibility:hidden}}
.small{font-size:12px;color:var(--muted)}

/* Ad slot */
.ad{display:grid;place-items:center;min-height:120px;border:1px dashed var(--border);border-radius:14px;background:color-mix(in oklab,var(--accent) 6%, var(--card));font-size:12px;color:var(--muted)}

  </style>
  <!-- GA4 (replace G-XXXXXXXXXX with your ID) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-XXXXXXXXXX');</script>
</head>
<body>
  <header>
    <h1>üèè <span data-i18n="title">Live Cricket</span> <span class="blink">‚Ä¢</span></h1>
    <div class="pill" id="net">online</div>
    <div class="right">
      <button id="langBtn">üåê ‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
      <button id="themeBtn">üåì</button>
      <button id="modeBtn">Push: OFF</button>
      <label class="small">‚è± <span data-i18n="interval">Interval</span> <input id="interval" type="number" min="2000" step="1000" value="5000"> ms</label>
    </div>
  </header>
  <div class="container">
    <!-- MATCH LIST -->
    <div id="listwrap">
      <div class="grid" id="matchlist"></div>
      <div class="small" id="listInfo" style="margin-top:10px;" data-i18n="tip">Tip: Tap a match to open the live scorecard.</div>
      <div class="card ad" id="ad-slot">Ad Slot ‚Äî place your ad code here</div>
    </div><!-- SCORECARD VIEW -->
<div id="scorewrap">
  <div class="toolbar">
    <button onclick="goBack()" data-i18n="back">‚¨Ö Back</button>
    <div class="tabs" id="tabs"></div>
    <div class="small" id="lastUp">‚Äî</div>
  </div>
  <div class="card">
    <div class="toprow">
      <div class="teams">
        <div class="logo" id="logoA"><span></span></div>
        <div class="names">
          <div>
            <div class="big" id="score">0/0</div>
            <div class="sub" id="overs">‚Äî</div>
          </div>
        </div>
      </div>
      <div class="names">
        <div class="sub" id="innings">‚Äî</div>
      </div>
    </div>
    <div class="status" id="status">Loading‚Ä¶</div>
  </div>

  <div class="tables">
    <div class="card">
      <h3 style="margin:0 0 8px 0" data-i18n="batting">Batting</h3>
      <table id="batting">
        <thead><tr>
          <th data-i18n="batsman">Batsman</th><th data-i18n="r">R</th><th data-i18n="b">B</th><th data-i18n="fours">4s</th><th data-i18n="sixes">6s</th><th data-i18n="sr">SR</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="card">
      <h3 style="margin:0 0 8px 0" data-i18n="bowling">Bowling</h3>
      <table id="bowling">
        <thead><tr>
          <th data-i18n="bowler">Bowler</th><th data-i18n="o">O</th><th data-i18n="m">M</th><th data-i18n="r">R</th><th data-i18n="w">W</th><th data-i18n="econ">Econ</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <div class="card ad" id="ad-slot-2">Ad Slot ‚Äî place your ad code here</div>
</div>

  </div><script>
let currentMatch = null;           // match id currently shown
let tabs = [];                     // [{id, title, code}]
let refresher = null;              // polling timer
let UPDATE_MS = 5000;              // default interval
let usePush = false;               // SSE toggle
let evtSrc = null;                 // EventSource
let lang = localStorage.getItem('lang') || 'en';

const I18N = {
  en: {
    title: 'Live Cricket', tip: 'Tip: Tap a match to open the live scorecard.', back: '‚¨Ö Back', batting: 'Batting', bowling: 'Bowling',
    batsman:'Batsman', bowler:'Bowler', r:'R', b:'B', fours:'4s', sixes:'6s', sr:'SR', o:'O', m:'M', w:'W', econ:'Econ', interval:'Interval'
  },
  hi: {
    title: '‡§≤‡§æ‡§á‡§µ ‡§ï‡•ç‡§∞‡§ø‡§ï‡•á‡§ü', tip: '‡§ü‡§ø‡§™: ‡§ï‡§ø‡§∏‡•Ä ‡§Æ‡•à‡§ö ‡§™‡§∞ ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≤‡§æ‡§á‡§µ ‡§∏‡•ç‡§ï‡•ã‡§∞‡§ï‡§æ‡§∞‡•ç‡§° ‡§ñ‡•ã‡§≤‡•á‡§Ç‡•§', back: '‚¨Ö ‡§µ‡§æ‡§™‡§∏', batting: '‡§¨‡§≤‡•ç‡§≤‡•á‡§¨‡§æ‡§ú‡§º‡•Ä', bowling: '‡§ó‡•á‡§Ç‡§¶‡§¨‡§æ‡§ú‡§º‡•Ä',
    batsman:'‡§¨‡§≤‡•ç‡§≤‡•á‡§¨‡§æ‡§ú‡§º', bowler:'‡§ó‡•á‡§Ç‡§¶‡§¨‡§æ‡§ú‡§º', r:'‡§∞‡§®', b:'‡§ó‡•á‡§Ç‡§¶', fours:'‡§ö‡•å‡§ï‡•á', sixes:'‡§õ‡§ï‡•ç‡§ï‡•á', sr:'‡§∏‡•ç‡§ü‡•ç‡§∞‡§æ‡§á‡§ï ‡§∞‡•á‡§ü', o:'‡§ì‡§µ‡§∞', m:'‡§Æ‡•á‡§°‡§®', w:'‡§µ‡§ø‡§ï‡•á‡§ü', econ:'‡§á‡§ï‡•â‡§®', interval:'‡§á‡§Ç‡§ü‡§∞‡§µ‡§≤'
  }
};

function applyLang(){
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    if(I18N[lang] && I18N[lang][key]) el.textContent = I18N[lang][key];
  });
  document.getElementById('langBtn').textContent = lang==='en' ? 'üåê ‡§π‡§ø‡§Ç‡§¶‡•Ä' : 'üåê English';
}

function setTheme(next){
  const html = document.documentElement;
  if(next){ html.setAttribute('data-theme', next); localStorage.setItem('theme', next); return; }
  const saved = localStorage.getItem('theme');
  if(saved){ html.setAttribute('data-theme', saved); return; }
  const prefers = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light':'dark';
  html.setAttribute('data-theme', prefers);
}

function setBadge(el, code){
  const colors = [ ['#3ea6ff','#0047ff'],['#22c55e','#065f46'],['#f97316','#b45309'],['#a78bfa','#4c1d95'],['#ef4444','#7f1d1d'],['#14b8a6','#134e4a'],['#eab308','#854d0e'] ];
  const pick = colors[(code?.toString().charCodeAt(0)||65)%colors.length];
  el.style.background = `linear-gradient(135deg, ${pick[0]}, ${pick[1]})`;
  el.style.border = '1px solid rgba(0,0,0,.15)';
  el.querySelector('span').textContent = (code||'T1').slice(0,3).toUpperCase();
}

function ago(){ return new Date().toLocaleTimeString(); }

async function loadMatches(){
  try{
    const res = await fetch('/matches', { cache: 'no-store' });
    const data = await res.json();

    const list = document.getElementById('matchlist');
    list.innerHTML = '';
    const ids = Object.keys(data);
    if(ids.length===0){
      list.innerHTML = '<div class="card" style="padding:16px">' + (lang==='hi'?'‡§á‡§∏ ‡§∏‡§Æ‡§Ø ‡§ï‡•ã‡§à ‡§≤‡§æ‡§á‡§µ ‡§Æ‡•à‡§ö ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§':'No live matches right now.') + '</div>';
      return;
    }
    ids.forEach(id=>{
      const m = data[id];
      const div = document.createElement('div');
      div.className = 'card match';
      div.innerHTML = `
        <div class="logo"><span></span></div>
        <div>
          <div><b>${m.team1 || 'Team A'}</b> <span class="vs">vs</span> <b>${m.team2 || 'Team B'}</b></div>
          <div class="meta">${m.status || ''}</div>
        </div>`;
      setBadge(div.querySelector('.logo'), (m.team1_code || m.team1 || 'T1'));
      div.onclick = ()=> addTab(id, m);
      list.appendChild(div);
    });
  }catch(e){
    document.getElementById('matchlist').innerHTML = '<div class="card" style="padding:16px">' + (lang==='hi'?'‡§Æ‡•à‡§ö ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§':'Failed to load matches.') + '</div>';
  }
}

function goBack(){
  stopUpdates();
  document.getElementById('scorewrap').style.display='none';
  document.getElementById('listwrap').style.display='block';
}

function renderTabs(){
  const wrap = document.getElementById('tabs');
  wrap.innerHTML = '';
  tabs.forEach(t => {
    const el = document.createElement('div');
    el.className = 'tab' + (t.id===currentMatch?' active':'');
    el.innerHTML = `<span>${t.title}</span> <span class="x" title="close">‚úï</span>`;
    el.onclick = (ev)=>{ if(ev.target.classList.contains('x')) closeTab(t.id); else switchTab(t.id); };
    wrap.appendChild(el);
  });
}

function addTab(id, meta){
  document.getElementById('listwrap').style.display='none';
  document.getElementById('scorewrap').style.display='block';
  if(!tabs.find(t=>t.id===id)){
    tabs.push({ id, title: `${meta.team1||'Team A'} vs ${meta.team2||'Team B'}`, code: meta.team1_code || meta.team1 || 'T1' });
  }
  switchTab(id);
}

function switchTab(id){
  currentMatch = id;
  const t = tabs.find(x=>x.id===id);
  if(t){ setBadge(document.getElementById('logoA'), t.code); }
  renderTabs();
  startUpdates();
}

function closeTab(id){
  const idx = tabs.findIndex(t=>t.id===id);
  if(idx>=0) tabs.splice(idx,1);
  if(currentMatch===id){ currentMatch = tabs[0]?.id || null; }
  renderTabs();
  if(currentMatch){ startUpdates(); } else { goBack(); }
}

function startUpdates(){
  stopUpdates();
  UPDATE_MS = Math.max(2000, parseInt(document.getElementById('interval').value||'5000',10));
  if(usePush){
    evtSrc = new EventSource('/sse/' + currentMatch);
    evtSrc.onmessage = (e)=>{ try{ render(JSON.parse(e.data)); }catch(_){} };
    evtSrc.onerror = ()=>{ usePush=false; updateModeBtn(); startUpdates(); };
  } else {
    loadScore();
    refresher = setInterval(loadScore, UPDATE_MS);
  }
}
function stopUpdates(){ if(evtSrc){ evtSrc.close(); evtSrc=null; } if(refresher){ clearInterval(refresher); refresher=null; } }

async function loadScore(){
  if(!currentMatch) return;
  try{
    const res = await fetch('/score/' + currentMatch, { cache: 'no-store' });
    const d = await res.json();
    render(d);
  }catch(e){ document.getElementById('status').textContent = lang==='hi'? '‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø' : 'Error loading score'; }
}

function render(d){
  document.getElementById('score').textContent = d.score || '‚Äî';
  document.getElementById('overs').textContent = d.overs? ((lang==='hi'?'‡§ì‡§µ‡§∞: ':'Overs: ') + d.overs):'';
  document.getElementById('status').textContent = d.status || '';
  document.getElementById('innings').textContent = d.innings || '';
  document.getElementById('lastUp').textContent = (lang==='hi'?'‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü: ':'Last update: ') + ago();

  const bat = document.querySelector('#batting tbody');
  bat.innerHTML = (d.batsmen||[]).map(b=>`<tr><td>${b.n}</td><td>${b.r}</td><td>${b.b}</td><td>${b.fd}</td><td>${b.si}</td><td>${b.sr}</td></tr>`).join('') || '<tr><td colspan="6">‚Äî</td></tr>';

  const bowl = document.querySelector('#bowling tbody');
  bowl.innerHTML = (d.bowlers||[]).map(o=>`<tr><td>${o.n}</td><td>${o.o??'-'}</td><td>${o.m??'-'}</td><td>${o.r??'-'}</td><td>${o.w??'-'}</td><td>${o.ec??'-'}</td></tr>`).join('') || '<tr><td colspan="6">‚Äî</td></tr>';
}

// --- UI Controls ---
const themeBtn = document.getElementById('themeBtn');
const langBtn = document.getElementById('langBtn');
const modeBtn = document.getElementById('modeBtn');
const intervalInput = document.getElementById('interval');

function updateModeBtn(){ modeBtn.textContent = (usePush? 'Push: ON' : 'Push: OFF'); }

themeBtn.onclick = ()=>{ const html = document.documentElement; const now = html.getAttribute('data-theme')==='dark'?'light':'dark'; setTheme(now); };
langBtn.onclick = ()=>{ lang = (lang==='en'?'hi':'en'); localStorage.setItem('lang', lang); applyLang(); };
modeBtn.onclick = ()=>{ usePush = !usePush; updateModeBtn(); startUpdates(); };
intervalInput.onchange = ()=>{ startUpdates(); };

window.addEventListener('online', ()=> document.getElementById('net').textContent='online');
window.addEventListener('offline', ()=> document.getElementById('net').textContent='offline');

// PWA register
if('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('/sw.js').catch(()=>{})); }

setTheme();
applyLang();
loadMatches();
</script></body>
</html>
  `);
});// ---------- API: Live matches (mapped) ---------- app.get('/matches', async (_req, res) => { res.setHeader('Cache-Control','no-cache'); try{ const data = await fetchJSON(MATCHES_URL); const out = {}; const matches = data.matches || {}; Object.keys(matches).forEach(id => { const m = matches[id] || {}; out[id] = { team1: m.team1?.name || m.team1?.sName || m.team1?.code, team2: m.team2?.name || m.team2?.sName || m.team2?.code, team1_code: m.team1?.sName || m.team1?.code, status: m.status || m.header?.status || '', }; }); res.json(out); }catch(e){ res.status(500).json({ error: 'Failed to load matches' }); } });

// ---------- API: Single match score (mapped) ---------- app.get('/score/:id', async (req, res) => { res.setHeader('Cache-Control','no-cache'); try{ const d = await fetchJSON(MATCH_URL(req.params.id)); const innings0 = (d.innings && d.innings[0]) ? d.innings[0] : null; const packet = { teams: { A: d.team?.[0]?.sName || d.team?.[0]?.name || 'T1', B: d.team?.[1]?.sName || d.team?.[1]?.name || 'T2' }, innings: innings0?.desc || '‚Äî', score: (innings0 ? ${innings0.score}/${innings0.wkts} : '‚Äî'), overs: innings0?.overs || '‚Äî', batsmen: (d.batsman || []).map(b => ({ n: (b.name || '-') + (b.strike ? '' : ''), r: b.runs, b: b.balls, fd: b.fours, si: b.sixes, sr: b.strikeRate })), bowlers: (d.bowler || []).map(o => ({ n: (o.name || '-') + (o.isBowling ? '' : ''), o: o.overs, m: o.maidens, r: o.runs, w: o.wkts, ec: o.economy })), status: d.status || d.header?.status || 'Live' }; res.json(packet); }catch(e){ res.status(500).json({ error: 'Failed to load score' }); } });

// ---------- API: SSE stream for push updates ---------- app.get('/sse/:id', async (req, res) => { res.setHeader('Content-Type','text/event-stream'); res.setHeader('Cache-Control','no-cache'); res.setHeader('Connection','keep-alive'); res.flushHeaders && res.flushHeaders();

let timer = null; let closed = false; req.on('close', ()=>{ closed=true; clearInterval(timer); });

async function pushOnce(){ try{ const d = await fetchJSON(MATCH_URL(req.params.id)); const innings0 = (d.innings && d.innings[0]) ? d.innings[0] : null; const packet = { teams: { A: d.team?.[0]?.sName || 'T1', B: d.team?.[1]?.sName || 'T2' }, innings: innings0?.desc || '‚Äî', score: (innings0 ? ${innings0.score}/${innings0.wkts} : '‚Äî'), overs: innings0?.overs || '‚Äî', batsmen: (d.batsman || []).map(b => ({ n: (b.name || '-') + (b.strike ? '' : ''), r: b.runs, b: b.balls, fd: b.fours, si: b.sixes, sr: b.strikeRate })), bowlers: (d.bowler || []).map(o => ({ n: (o.name || '-') + (o.isBowling ? '' : ''), o: o.overs, m: o.maidens, r: o.runs, w: o.wkts, ec: o.economy })), status: d.status || d.header?.status || 'Live' }; res.write(`data: ${JSON.stringify(packet)}

`); }catch(e){ /* ignore errors, try next tick */ } }

await pushOnce(); timer = setInterval(()=>{ if(!closed) pushOnce(); }, 5000); });

// ---------- PWA ASSETS ---------- app.get('/manifest.webmanifest', (_req, res) => { res.setHeader('Content-Type','application/manifest+json'); res.send(JSON.stringify({ name: 'Live Cricket', short_name: 'Cricket', start_url: '/', display: 'standalone', background_color: '#0b1220', theme_color:'#0b1220', icons: [ { src: '/icon.svg', sizes: '512x512', type: 'image/svg+xml', purpose: 'any maskable' } ] })); });

app.get('/icon.svg', (_req, res) => { res.setHeader('Content-Type','image/svg+xml'); res.send(<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'> <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='#3ea6ff'/><stop offset='1' stop-color='#0047ff'/></linearGradient></defs> <rect width='128' height='128' rx='24' fill='url(#g)'/> <circle cx='42' cy='64' r='16' fill='white' opacity='.9'/> <rect x='62' y='54' width='36' height='6' rx='3' fill='white'/> <rect x='62' y='68' width='36' height='6' rx='3' fill='white' opacity='.8'/> </svg>); });

app.get('/sw.js', (_req, res) => { res.setHeader('Content-Type','application/javascript'); res.send(self.addEventListener('install', (e)=>{ e.waitUntil(caches.open('cricket-shell-v1').then(c=>c.addAll(['/','/manifest.webmanifest','/icon.svg']))); }); self.addEventListener('activate', (e)=>{ e.waitUntil(self.clients.claim()); }); self.addEventListener('fetch', (e)=>{ const url = new URL(e.request.url); if(url.pathname.startsWith('/score/') || url.pathname.startsWith('/matches') || url.pathname.startsWith('/sse/')){ return; // network-only for live data } e.respondWith(caches.match(e.request).then(r=> r || fetch(e.request).then(resp=>{ const copy = resp.clone(); caches.open('cricket-shell-v1').then(c=>c.put(e.request, copy)); return resp; }))); });); });

// ---------- START ---------- app.listen(PORT, () => console.log(‚úÖ Live Cricket running on http://localhost:${PORT}));

